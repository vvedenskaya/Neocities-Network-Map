<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bombay Mars LAN Map</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='14' fill='%234ecdc4' stroke='%233ba89f' stroke-width='2'/><circle cx='16' cy='16' r='4' fill='%23fff'/></svg>">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@10.7.0/ol.css">
  <link rel="stylesheet" href="map.css">
</head>
<body>
  <div id="app">
    <header class="header">
      <h1>Bombay Mars LAN Map</h1>
      <div class="controls">
        <button id="refresh-btn" type="button" title="Reload network data">Refresh</button>
        <label class="admin-toggle">
          <input type="checkbox" id="admin-mode" />
          <span>Admin (drag devices)</span>
        </label>
        <button id="export-positions-btn" class="secondary-btn" title="Export UniFi + UISP positions to JSON">Export positions</button>
      </div>
    </header>

    <main class="main">
      <aside class="sidebar">
        <section class="controls-group">
          <h3>Map Layers</h3>
          <div class="layer-selector">
            <label><input type="radio" name="base-layer" value="osm" checked> Streets</label>
            <label><input type="radio" name="base-layer" value="satellite"> Satellite</label>
          </div>
          <div class="layer-overlay">
            <label><input type="checkbox" id="layer-drone-overlay"> Drone photo</label>
          </div>
        </section>

        <section class="controls-group">
          <h3>Visibility</h3>
          <label><input type="checkbox" id="layer-uisp" checked> UISP Devices</label>
          <label><input type="checkbox" id="layer-unifi" checked> UniFi Devices</label>
          <label><input type="checkbox" id="layer-wireless" checked> Wireless Links</label>
          <label><input type="checkbox" id="layer-wired" checked> Wired Links</label>
          <label><input type="checkbox" id="layer-clients" checked> Client Devices</label>
        </section>

        <section class="controls-group">
          <div class="section-header">
            <h3>Devices</h3>
            <button id="toggle-device-list" class="toggle-btn" title="Toggle Device List">▼</button>
          </div>
          <div id="device-list-container" class="collapsible-content">
            <input type="text" id="device-search" placeholder="Search devices..." class="search-input">
            <div id="device-list" class="device-list">
              <!-- Populated by JS -->
            </div>
          </div>
        </section>

        <section class="controls-group">
          <h3>Filters</h3>
          <label><input type="checkbox" id="filter-online-only"> Online Only</label>
          
          <div class="filter-range">
            <label for="filter-signal">Min Signal (dBm): <span id="signal-value">-90</span></label>
            <input type="range" id="filter-signal" min="-90" max="-40" value="-90">
          </div>
        </section>
      </aside>

      <div id="map" class="map"></div>

      <aside id="inspector" class="inspector hidden">
        <div class="inspector-header">
          <h2 id="inspector-title">Details</h2>
          <button id="inspector-close" type="button" aria-label="Close">×</button>
        </div>
        <div id="inspector-content" class="inspector-content"></div>
      </aside>
    </main>

    <section id="timeline-panel" class="timeline-panel">
      <div class="timeline-top">
        <div id="timeline-ts" class="timeline-ts">Now</div>
        <div class="timeline-controls-right">
          <select id="timeline-range" class="timeline-range" title="Timescale">
            <option value="24h">24h</option>
            <option value="7d">7d</option>
            <option value="30d">30d</option>
          </select>
          <select id="timeline-speed" class="timeline-speed" title="Playback speed">
          <option value="1">1x</option>
          <option value="2">2x</option>
          <option value="4">4x</option>
          </select>
        </div>
      </div>
      <div class="timeline-row">
        <button id="timeline-play" type="button" class="timeline-btn" aria-label="Play timeline">▶</button>
        <div class="timeline-slider-wrap">
          <input id="timeline-slider" class="timeline-slider" type="range" min="0" max="0" value="0" step="1" />
          <div class="timeline-hours">
            <span>7p</span><span>8p</span><span>9p</span><span>10p</span><span>11p</span><span>12a</span><span>1a</span><span>2a</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Библиотека для чтения GeoTIFF — должна быть загружена до OpenLayers -->
  <script src="https://cdn.jsdelivr.net/npm/geotiff@2.1.3/dist-browser/geotiff.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ol@10.7.0/dist/ol.js"></script>
  <script src="map.js"></script>
</body>
</html>
